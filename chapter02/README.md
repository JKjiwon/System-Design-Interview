# chapter2. 개략적인 규모 추정

`규모의 확장성: 2의 제곱수, 응답지연(latency) 값, 가용성`

## 2의 제곱수

| 2의 x제곱 | 근사치   | 이름  |
|--------|-------|-----|
| 10     | 1천    | 1KB |
| 20     | 1백만   | 1MB |
| 30     | 10억   | 1GB |
| 40     | 1조    | 1TB |
| 50     | 1000조 | 1PB |

## 응답지연(latency) 값

| 연산명                                 | 시간                    |
|-------------------------------------|-----------------------|
| L1 캐시 참조                            | 0.5ns                 |
| 분기 예측 오류(branch mispredict)         | 5ns                   |
| L2 캐시 참조                            | 7ns                   |
| 뮤택스(mutex) 락/언락                     | 100ns                 |
| 주 메모리 참조                            | 100ns                 |
| Snappy로 1 KB 압축                     | 10,000ns = 10μs       |
| 1 Gbps 네트워크로 2 KB 전송                | 20,000ns = 20μs       |
| 메모리에서 1MB 순차적으로 read                | 250,000ns = 250μs     |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간          | 500,000ns = 500μs     |
| 디스크 탐색(seek)                        | 10,000,000ns = 10ms   |
| 네트워크에서 1 MB 순차적으로 read              | 10,000,000ns = 10ms   |
| 디스크에서 1 MB 순차적으로 read               | 30,000,000ns = 30ms   |
| 한 패킷의 CA(캘리포니아)로부터 네덜란드까지의 왕복 지연 시간 | 150,000,000ns = 150ms |

### 결론

- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색(seek)은 가능한 피하라.
- 단순한 압출 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고 받는데는 시간이 걸린다.

## 가용성에 관한 수치

- 고가용성(high availablilty)
    - 시스템이 오랜 시간 동안 지속적으로 중단없이 운영 될 수 있는 능력
    - 100%는 시스템이 한번도 중단된 적이 없음, 99~100% 사이의 값을 가짐
- SLA(Service Level Agreement)
    - 서비스 사업자와 고객 사이에 맺어진 합의
    - 서비스가 제공하는 서비스의 `가용시간(uptime)`이 기술됨
    - 아마존, 구글,마이크로소프와 같은 사업자는 99%이상의 SLA를 제공

## QPS와 저장소 요구량

- QPS(Query Per Second)
- 최대 QPS(Peek QPS): 모든 사용자가 동시에 트윗을 하는 경우 고려(책에서는 평균 50%만 사용한다고 했으므로, 전체가 이용하면 X2를 해주어야한다.)
- N년간의 저장소 요구량: 일간 저장소 요구량 * 365 * N

### QPS vs TPS

- QPS는 초당 처리되는 개별 쿼리나 요청의 수를 측정한다.
- TPS는 완전한 트랜잭션의 수를 초당 처리하며, 여기서 트랜잭션은 여러 쿼리나 작업으로 이루어질 수 있다.

## 참조

[가상 면접 사례로 배우는 대규모 시스템 설계 기초](https://www.yes24.com/Product/Goods/102819435)